<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Video Downloader</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        :root {
            --primary-color: #ff4757;
            --secondary-color: #3742fa;
            --background-color: #1a1a2e;
            --surface-color: #2c3e50;
            --text-color: #e5e5e5;
            --border-radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--background-color); color: var(--text-color); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: var(--surface-color); border-radius: var(--border-radius); overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .header { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; padding: 40px; text-align: center; }
        .header h1 { font-size: 2.5em; font-weight: 700; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .input-section { padding: 40px; background: #16213e; }
        .input-group { display: flex; gap: 15px; }
        #urlInput { flex: 1; padding: 18px 20px; background: #0f0f23; border: 2px solid #2c3e50; border-radius: var(--border-radius); font-size: 16px; color: var(--text-color); outline: none; transition: all .3s ease; }
        #urlInput:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(255,71,87,.2); }
        #downloadBtn { padding: 18px 35px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; border: none; border-radius: var(--border-radius); font-size: 16px; font-weight: 600; cursor: pointer; transition: all .3s ease; }
        #downloadBtn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        #downloadBtn:disabled { opacity: .6; cursor: not-allowed; }
        .loading { text-align: center; padding: 40px; display: none; }
        .spinner { border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--primary-color); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .video-info { display: none; padding: 40px; }
        .video-header { display: flex; gap: 25px; margin-bottom: 30px; align-items: center; }
        .thumbnail { width: 160px; height: 90px; border-radius: var(--border-radius); object-fit: cover; }
        .formats { margin-top: 20px; }
        .format-category h4 { margin-bottom: 15px; font-size: 1.2em; color: var(--primary-color); border-bottom: 2px solid var(--surface-color); padding-bottom: 10px; }
        .format-item { display: grid; grid-template-columns: 1fr auto; align-items: center; padding: 15px; background: #16213e; border-radius: var(--border-radius); margin-bottom: 10px; transition: all .3s ease; }
        .format-item:hover { background: #1e2a47; }
        .download-link, .play-btn { padding: 10px 20px; color: white; text-decoration: none; border-radius: 8px; font-size: 14px; font-weight: 600; transition: all .3s ease; cursor: pointer; border: none; }
        .download-link { background: linear-gradient(135deg, #00d2d3, #54a0ff); }
        .play-btn { background: linear-gradient(135deg, #2ed573, #1dd1a1); margin-right: 10px; }
        .format-actions { display: flex; }
        .js-player { position: relative; background: #000; border-radius: var(--border-radius); overflow: hidden; margin-top: 20px; }
        .js-player video { width: 100%; display: block; }
        .player-controls { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,.8)); padding: 15px; display: flex; align-items: center; gap: 15px; }
        .play-pause, .fullscreen-btn { background: none; border: none; color: white; font-size: 20px; cursor: pointer; }
        .progress-bar { flex: 1; height: 8px; background: rgba(255,255,255,.3); border-radius: 4px; cursor: pointer; }
        .progress-fill { height: 100%; background: var(--primary-color); border-radius: 4px; width: 0; }
        .time-display { color: white; font-size: 12px; }
        .volume-control { display: flex; align-items: center; gap: 8px; }
        .volume-slider { width: 80px; }
        .error { background: #ff4757; color: white; padding: 20px; border-radius: var(--border-radius); margin: 20px 40px; display: none; }
    </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>üé• YouTube Downloader</h1>
    <p>Download YouTube videos in various formats</p>
  </div>

  <div class="input-section">
    <div class="input-group">
      <input type="text" id="urlInput" placeholder="Paste YouTube URL here..." />
      <button id="downloadBtn" onclick="fetchVideoInfo()">Get Download Links</button>
    </div>
  </div>

  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p>Fetching video information...</p>
  </div>

  <div class="error" id="error"></div>

  <div class="video-info" id="videoInfo">
    <div class="video-header">
      <img id="thumbnail" class="thumbnail" src="" alt="Video thumbnail">
      <div>
        <h3 id="videoTitle"></h3>
        <p><strong>Duration:</strong> <span id="duration"></span></p>
        <p><strong>Source:</strong> <span id="source"></span></p>
      </div>
    </div>
    <div class="video-player" id="videoPlayer" style="display:none;margin:20px 0;">
      <div style="margin-bottom:10px;">
        <select id="qualitySelect" style="padding:8px;background:#16213e;color:#e5e5e5;border:1px solid #2c3e50;border-radius:6px;" onchange="changeQuality()">Quality</select>
      </div>
      <div class="js-player" id="jsPlayer">
        <video id="playerVideo"></video>
        <div class="player-controls">
          <button class="play-pause" onclick="togglePlay()">‚ñ∂</button>
          <div class="progress-bar" onclick="seek(event)">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
          <select id="playerQuality" style="background:#333;color:white;border:none;padding:4px;border-radius:4px;" onchange="changePlayerQuality()"></select>
          <div class="volume-control">
            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="1" onchange="setVolume()">
          </div>
          <button class="download-current-btn" onclick="downloadCurrentVideo()" style="background:none;border:none;color:white;font-size:16px;cursor:pointer;padding:5px;" title="Download Current Quality">‚¨á</button>
          <button class="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂</button>
        </div>
      </div>
    </div>
    <div class="formats" id="formats"></div>
  </div>
</div>

<script>
async function fetchVideoInfo() {
  const urlInput = document.getElementById('urlInput');
  const url = urlInput.value.trim();

  if (!url) return showError('Please enter a YouTube URL');
  if (!isValidYouTubeUrl(url)) return showError('Please enter a valid YouTube URL');

  showLoading(true); hideError(); hideVideoInfo();

  try {
    const apiUrl = `/.netlify/functions/proxy?action=info&url=${encodeURIComponent(url)}`;
    const response = await fetch(apiUrl);
    if (!response.ok) throw new Error("Failed to fetch video info");

    const data = await response.json();
    if (data.error) throw new Error(data.error);

    displayA2ZResult(data);
  } catch (err) {
    showError(err.message);
  } finally {
    showLoading(false);
  }
}

function isValidYouTubeUrl(url){
  return /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/.test(url);
}

function displayA2ZResult(data){
  const info=data.data;
  document.getElementById('thumbnail').src=info.cover;
  document.getElementById('videoTitle').textContent=info.title;
  document.getElementById('duration').textContent=formatDuration(info.duration);
  document.getElementById('source').textContent='YouTube';

  const formats=info.items;
  const videoWithAudio=formats.filter(f=>f.type==='video_with_audio');
  const videoOnly=formats.filter(f=>f.type==='video');
  const audioOnly=formats.filter(f=>f.type==='audio');

  if(videoWithAudio.length || videoOnly.length){
    const allVideos=[...videoWithAudio,...videoOnly];
    setupVideoPlayer(allVideos);
    document.getElementById('videoPlayer').style.display='block';
  }

  const formatsContainer=document.getElementById('formats');
  formatsContainer.innerHTML='';

  if(videoWithAudio.length)formatsContainer.appendChild(createFormatSection('Video with Audio',videoWithAudio));
  if(videoOnly.length)formatsContainer.appendChild(createFormatSection('Video Only',videoOnly));
  if(audioOnly.length)formatsContainer.appendChild(createFormatSection('Audio Only',audioOnly));

  document.getElementById('videoInfo').style.display='block';
}

function createFormatSection(title,formats){
  const section=document.createElement('div');
  section.className='format-category';
  const h4=document.createElement('h4');
  h4.textContent=title; section.appendChild(h4);

  formats.forEach(format=>{
    const item=document.createElement('div');
    item.className='format-item';
    const info=document.createElement('div');
    info.innerHTML=`<div>${format.label}</div><div style="color:#95a5a6;font-size:13px;">${format.ext.toUpperCase()}</div>`;

    const actions=document.createElement('div');
    actions.className='format-actions';
    
    if(format.type.includes('video')){
      const playBtn=document.createElement('button');
      playBtn.className='play-btn';
      playBtn.textContent='‚ñ∂ Play';
      playBtn.onclick=()=>playVideo(format.url);
      actions.appendChild(playBtn);
    }
    
    const dl=document.createElement('button');
    dl.className='download-link';
    dl.textContent='‚¨á Download';
    dl.onclick=()=>downloadVideo(format.url,format.label,format.ext);

    actions.appendChild(dl);
    item.appendChild(info);
    item.appendChild(actions);
    section.appendChild(item);
  });
  return section;
}

function setupVideoPlayer(videos){
  const select=document.getElementById('qualitySelect');
  const playerSelect=document.getElementById('playerQuality');
  const video=document.getElementById('playerVideo');
  const thumbnail = document.getElementById('thumbnail').src;
  
  select.innerHTML='';
  playerSelect.innerHTML='';
  
  videos.forEach((v,i)=>{
    const option1=document.createElement('option');
    option1.value=i;
    option1.textContent=v.label;
    select.appendChild(option1);
    
    const option2=document.createElement('option');
    option2.value=i;
    option2.textContent=v.label;
    playerSelect.appendChild(option2);
  });
  
  window.videoSources=videos;
  video.src=videos[0].url;
  video.poster = thumbnail;
}

function changeQuality(){
  const select=document.getElementById('qualitySelect');
  const video=document.getElementById('playerVideo');
  const currentTime=video.currentTime;
  video.src=window.videoSources[select.value].url;
  video.currentTime=currentTime;
  document.getElementById('playerQuality').value=select.value;
}

function changePlayerQuality(){
  const select=document.getElementById('playerQuality');
  const video=document.getElementById('playerVideo');
  const currentTime=video.currentTime;
  video.src=window.videoSources[select.value].url;
  video.currentTime=currentTime;
  document.getElementById('qualitySelect').value=select.value;
}

function playVideo(url){
  const video=document.getElementById('playerVideo');
  video.src=url;
  video.play();
  document.getElementById('videoPlayer').style.display='block';
  video.scrollIntoView({behavior:'smooth'});
}

function togglePlay(){
  const video=document.getElementById('playerVideo');
  const btn=document.querySelector('.play-pause');
  if(video.paused){video.play();btn.textContent='‚è∏';}else{video.pause();btn.textContent='‚ñ∂';}
}

function seek(e){
  const video=document.getElementById('playerVideo');
  const bar=e.currentTarget;
  const rect=bar.getBoundingClientRect();
  const pos=(e.clientX-rect.left)/rect.width;
  video.currentTime=pos*video.duration;
}

function setVolume(){
  const video=document.getElementById('playerVideo');
  const slider=document.getElementById('volumeSlider');
  video.volume=slider.value;
}

function toggleFullscreen(){
  const player=document.getElementById('jsPlayer');
  if(document.fullscreenElement){document.exitFullscreen();}else{player.requestFullscreen();}
}

function updateProgress(){
  const video=document.getElementById('playerVideo');
  const fill=document.getElementById('progressFill');
  const time=document.getElementById('timeDisplay');
  if(video.duration){
    const progress=(video.currentTime/video.duration)*100;
    fill.style.width=progress+'%';
    time.textContent=formatTime(video.currentTime)+' / '+formatTime(video.duration);
  }
}

function formatTime(s){
  const m=Math.floor(s/60);
  const sec=Math.floor(s%60);
  return m+':'+(sec<10?'0':'')+sec;
}

function downloadVideo(url,label,ext){
  const title=document.getElementById('videoTitle').textContent;
  const filename=`${title}_${label}.${ext}`;
  
  const netlifyUrl='/.netlify/functions/proxy';
  const proxyUrl=`${netlifyUrl}?url=${encodeURIComponent(url)}&filename=${encodeURIComponent(filename)}`;
  
  const link=document.createElement('a');
  link.href=proxyUrl;
  link.download=filename;
  link.style.display='none';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function downloadCurrentVideo(){
  const select=document.getElementById('playerQuality');
  const currentQuality=window.videoSources[select.value];
  downloadVideo(currentQuality.url,currentQuality.label,currentQuality.ext);
}

function formatDuration(s){const m=Math.floor(s/60),r=s%60;return `${m}:${r.toString().padStart(2,'0')}`}
function showLoading(b){document.getElementById('loading').style.display=b?'block':'none';document.getElementById('downloadBtn').disabled=b;}
function showError(msg){const e=document.getElementById('error');e.textContent=msg;e.style.display='block';}
function hideError(){document.getElementById('error').style.display='none';}
function hideVideoInfo(){document.getElementById('videoInfo').style.display='none';document.getElementById('videoPlayer').style.display='none';document.getElementById('playerVideo').src='';}

setInterval(updateProgress,100);
</script>
</body>
</html>
